#
# 
# Convert Albula v3.0.0 hdf5 data into matlab format
# Using Albula v3.0.0 API
#
# Author: Zhentian Wang
#
#
# History:
# 01.06.2015: first release
#
#################################################################

#imports
import sys
sys.path.insert(0,"/sls/X02DA/data/e13510/Data20/ALBULA3/dectris/albula/3.0/python") # or wherever you've installed ALBULA
import dectris.albula

import time
import ConfigParser
import thread
import matplotlib.pyplot as plt
import scipy.io as sio
import numpy as np



storagePath = "/sls/X02DA/data/e13510/Data20/EIGER_DATA"
file_id = 1

h5cont = dectris.albula.DImageSeries(storagePath + "//series_" + str(file_id) + "_master.h5")
# loop over the frames in the image series to display them in albula
dataset = h5cont[h5cont.first()].data()
#dataset = []
#print h5cont.size()
for i in range(h5cont.first(), h5cont.first() + h5cont.size()-1):
	img = h5cont[i+1]
	dat = img.data()
	dataset = np.concatenate((dataset, dat))
sio.savemat(storagePath + "//dat_" + str(file_id) + ".mat", {'img': dataset})
